<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="point">

	<!-- 회원 가입 시 자동 포인트 insert -->
	<insert id="insertJoinPoint" parameterType="PointDTO">
	INSERT INTO point_tb (
		<trim prefixOverrides=",">
			<if test="memIdx     !=null and memIdx     !=''"> , mem_idx     </if>
			<if test="poiContent !=null and poiContent !=''"> , poi_content </if>
			<if test="poiPoint   !=null and poiPoint   !=''"> , poi_point   </if>
		</trim>
		) VALUES(
		<trim prefixOverrides=",">
			<if test="memIdx     !=null and memIdx     !=''"> , #{memIdx}     </if>
			<if test="poiContent !=null and poiContent !=''"> , #{poiContent} </if>
			<if test="poiPoint   !=null and poiPoint   !=''"> , #{poiPoint}   </if>
		</trim>
		)
		<selectKey resultType="Integer" keyProperty="memIdx" order="BEFORE">
			SELECT LAST_INSERT_ID()
		</selectKey>
	</insert>
	
	<!-- 회원별 포인트 계산 mem_idx 조건 -->
	<select id="selectPointTotalAmount" resultType="String">
		SELECT SUM(poi_point)
		FROM point_tb
		WHERE mem_idx = #{memIdx}
		GROUP BY mem_idx
	</select>
	
	<!-- 전체 회원별 포인트 계산 -->
	<select id="selectPointTotalAmountAll" resultType="MemberDTO">
		SELECT mem_idx, SUM(poi_point) AS poi_point
		FROM point_tb
		GROUP BY mem_idx
	</select>
	
	
	<!-- 충전 시 충전 포인트 insert -->
	<insert id="insertPayPoint" parameterType="PointDTO">
	INSERT INTO point_tb (
		<trim prefixOverrides=",">
			<if test="memIdx     !=null and memIdx     !=''"> , mem_idx     </if>
			<if test="poiContent !=null and poiContent !=''"> , poi_content </if>
			<if test="poiPoint   !=null and poiPoint   !=''"> , poi_point   </if>
		</trim>
		) VALUES(
		<trim prefixOverrides=",">
			<if test="memIdx     !=null and memIdx     !=''"> , #{memIdx}     </if>
			<if test="poiContent !=null and poiContent !=''"> , #{poiContent} </if>
			<if test="poiPoint   !=null and poiPoint   !=''"> , #{poiPoint}  </if>
		</trim>
		)

	</insert>
	
	<!--  포인트 충전,차감 데이터 insert -->
	<insert id="insertPointChange" parameterType="PointDTO">
	INSERT INTO point_tb (
		<trim prefixOverrides=",">
			<if test="memIdx     !=null and memIdx     !=''"> , mem_idx     </if>
			<if test="poiContent !=null and poiContent !=''"> , poi_content </if>
			<if test="poiPoint   !=null and poiPoint   !=''"> , poi_point   </if>
		</trim>
		) VALUES(
		<trim prefixOverrides=",">
			<if test="memIdx     !=null and memIdx     !=''"> , #{memIdx}     </if>
			<if test="poiContent !=null and poiContent !=''"> , #{poiContent} </if>
			<if test="poiPoint   !=null and poiPoint   !=''"> , #{poiPoint}  </if>
		</trim>
		)

	</insert>
		
</mapper>